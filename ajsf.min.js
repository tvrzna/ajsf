/**
	ajsf 0.0.1

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(s,n){for(var e in n.find("[ajsf-bind]").each(function(e,t){var i,a=$(t),r=a.attr("ajsf-bind");if(void 0===Ajsf.digObject(s,r)&&Ajsf.digObject(s,r,""),"INPUT"===a.prop("tagName")||"TEXTAREA"===a.prop("tagName")||"SELECT"===a.prop("tagName")){if("TEXTAREA"===a.prop("tagName"))i="input";else switch(a.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":i="input";break;case"submit":break;default:i="change"}void 0!==i&&a.on(i,function(){Ajsf.digObject(s,r,Ajsf.getVal(t)),Ajsf.refresh(s,n,r)})}}),createEvent=function(r){n.find("["+r+"]").each(function(e,t){var i=$(t),a=i.attr(r);i.on(Ajsf.basicEvents[r],function(e){Ajsf.digObject(s,a)(e,t)})})},Ajsf.basicEvents)createEvent(e);Ajsf.refresh(s,n)},basicEvents:{"ajsf-blur":"blur","ajsf-change":"change","ajsf-click":"click","ajsf-keydown":"keydown","ajsf-keyup":"keyup","ajsf-mousedown":"mousedown","ajsf-mouseup":"mouseup","ajsf-submit":"submit"},digObject:function(e,t,i){var a,r=t.split("|"),s=r[0].trim(),n=!1,t=!1;if((s.startsWith("'")&&s.endsWith("'")||s.startsWith('"')&&s.endsWith('"'))&&(t=!0,a=s.substring(1,s.length-1)),!t){s.startsWith("!")&&(s=r[0].substring(1).trim(),n=!0);for(var f,c=/(.*?)\[([0-9]+)\]/g,o=s.split("."),p=0,d=e.context;p<o.length-1;p++)null!==(f=c.exec(o[p]))&&void 0!==d[f[1]][f[2]]?d=d[f[1]][f[2]]:void 0!==d[o[p]]&&(d=d[o[p]]);if(null!==(f=c.exec(o[p]))){if(void 0!==i)return void(d[f[1]][f[2]]=i);a=d[f[1]][f[2]]}else{if(void 0!==i)return void(d[o[p]]=i);a=d[o[p]]}n&&(a=!a)}for(var l=1;l<r.length;l++)null!=r[l]&&(a=Ajsf.filter(e,r[l].trim(),a));return a},filter:function(e,t,i){if(null==i)return i;var a,r,s=(t=t.replace(/\s\s+/g," ")).split(" ")[0];for(r in 0<t.indexOf(" ")&&void 0!==(a=t.substring(t.indexOf(" ")).trim())&&(a=a.startsWith("'")&&a.endsWith("'")||a.startsWith('"')&&a.endsWith('"')?a.substring(1,a.length-1):isNaN(a)?Ajsf.digObject(e,a):Number(a)),e.filters)if(r.toLowerCase()===s.toLowerCase()){var n=void 0!==e.context.parent?e.context.parent():e.context;return e.filters[r].definition(n,i,a)}switch(s.toLowerCase()){case"gt":return a<i;case"gte":return a<=i;case"lt":return i<a;case"lte":return i<=a;case"eq":return i==a;case"ne":return i!=a;case"limit":return i.slice(0,Number(a));default:return console.warn("Filter "+s+" is not implemented yet."),i}},refresh:function(app,el,attr){var prefix=":not([ajsf-repeated]) > ";el.is("[ajsf-repeated]")&&(prefix="");var suffix="",name,name,i;for(name in void 0!==attr&&void 0!==Ajsf.digObject(app,attr)&&(suffix='="'+attr+'"'),el.find(prefix+"[ajsf-bind"+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr("ajsf-bind")),Ajsf.setVal(t,Ajsf.digObject(app,i))}),el.find(prefix+"[ajsf-hide"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-hide")),Ajsf.digObject(app,t)?i.hide():i.show()}),el.find(prefix+"[ajsf-show"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-show")),Ajsf.digObject(app,t)?i.show():i.hide()}),el.find(prefix+"[ajsf-class]").each(function(i,e){var $e=$(e),cpyAttr=JSON.parse(JSON.stringify(eval("("+$e.attr("ajsf-class")+")"))),styleClass;for(styleClass in cpyAttr){var value=Ajsf.digObject(app,cpyAttr[styleClass]);value?$e.hasClass(styleClass)||$e.addClass(styleClass):$e.removeClass(styleClass)}}),el.find(prefix+"[ajsf-repeated"+suffix+"]").each(function(e,t){$(t).remove()}),el.find(prefix+"[ajsf-title"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-title")),i.attr("title",Ajsf.digObject(app,t))}),el.find(prefix+"[ajsf-repeat"+suffix+"]").each(function(e,t){var i=$(t),t=attr;i.hide(),""===suffix&&(t=i.attr("ajsf-repeat"));var a=Ajsf.digObject(app,t);if(void 0!==a)for(var r in a){var s=i.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated","true").show().insertBefore(i),n={context:{parent:function(){return app.context},item:a[r]},directives:app.directives,filters:app.filters,attributes:app.attributes};n.context.item.index=r,Ajsf.init(n,s)}}),app.attributes)el.find(prefix+"["+name+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr(name)),app.attributes[name].definition(t,Ajsf.digObject(app,i),app.context)});for(name in app.directives){void 0===app.context.directiveInstances&&(app.context.directiveInstances=[]);var directive=app.directives[name],applyDirective=function(e){var t=$(e),i=t.attr("ajsf-model"),a=void 0;null!==i&&(a=Ajsf.digObject(app,i)),t.html(directive.template);var r={context:{model:a,parent:function(){return app.context},refresh:function(e){e||"function"!=typeof r.context.onRefresh||r.context.onRefresh(),Ajsf.refresh(r,t)}},directives:app.directives,filters:app.filters,attributes:app.attributes};void 0!==directive.definition&&(r.context=Object.assign(r.context,directive.definition(r.context,e))),Ajsf.init(r,t),app.context.directiveInstances.push(r)};el.prop("tagName")!==name.toUpperCase()||null===el.attr("ajsf-repeat")&&null===el.attr("ajsf-repeated")?el.find(name).each(function(e,t){var i=$(t);""===i.html()&&null===i.attr("ajsf-repeat")&&null===i.attr("ajsf-repeated")&&applyDirective(t)}):""===el.html()&&applyDirective(el[0])}for(i in app.context.directiveInstances)void 0!==app.context.directiveInstances[i]&&void 0!==app.context.directiveInstances[i].context&&app.context.directiveInstances[i].context.refresh()},getVal:function(e){var t=$(e);switch(t.prop("type")){case"checkbox":return t.prop("checked");case"radio":for(var i=t.attr("ajsf-bind"),a=$("input[ajsf-bind="+i+"][type=radio]"),r=0;r<=a.length;r++)if((t=$(a[r])).prop("checked"))return t.val();return null;default:return t.val()}},setVal:function(e,t){var i=$(e);if("INPUT"===i.prop("tagName"))switch(i.prop("type")){case"checkbox":i.prop("checked",t);break;case"radio":i.prop("checked",e.value==t);break;default:i.val(t)}else"TEXTAREA"===i.prop("tagName")||"SELECT"===i.prop("tagName")?i.val(t):i.text(t)}},window.ajsf=function(e,t){var i=$('[ajsf="'+e+'"]'),a={context:{},directives:{},directive:function(e,t,i){this.directives[e]={name:e,template:t,definition:i}},filters:{},filter:function(e,t){this.filters[e]={name:e,definition:t}},attributes:{},attribute:function(e,t){this.attributes[e]={name:e,definition:t}}};return a.context.refresh=function(){Ajsf.refresh(a,i)},a.context=Object.assign(a.context,t(a.context)),$(document).ready(function(){Ajsf.init(a,i)}),a};
