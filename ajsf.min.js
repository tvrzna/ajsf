/**
	ajsf 0.0.1-20211105

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(a,s,t){for(var e in s.find("[ajsf-bind]").each(function(t,e){var i,r=$(e),n=r.attr("ajsf-bind");if(void 0===Ajsf.digObject(a,n)&&Ajsf.digObject(a,n,""),"INPUT"===r.prop("tagName")||"TEXTAREA"===r.prop("tagName")||"SELECT"===r.prop("tagName")){if("TEXTAREA"===r.prop("tagName"))i="input";else switch(r.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":i="input";break;case"submit":break;default:i="change"}void 0!==i&&r.on(i,function(){Ajsf.digObject(a,n,Ajsf.getVal(e)),Ajsf.refresh(a,s,n)})}}),createEvent=function(r){s.find("["+r+"]").each(function(t,e){var e=$(e),i=e.attr(r);e.on(Ajsf.basicEvents[r],function(t){var e=Ajsf.digObject(a,i,void 0,!0);"function"==typeof e[0]&&e[0](t,...e[1],$(this))})})},Ajsf.basicEvents)createEvent(e);Ajsf.refresh(a,s,void 0,t)},basicEvents:{"ajsf-blur":"blur","ajsf-change":"change","ajsf-click":"click","ajsf-keydown":"keydown","ajsf-keyup":"keyup","ajsf-mousedown":"mousedown","ajsf-mouseup":"mouseup","ajsf-submit":"submit"},convertToObject:function(str){return JSON.parse(JSON.stringify(eval("("+str+")")))},digObject:function(t,e,i,r){var n,a=e.split("|"),s=!1,f=!1,e=!1,o=[];if(((u=a[0].trim()).startsWith("'")&&u.endsWith("'")||u.startsWith('"')&&u.endsWith('"'))&&(f=!0,n=u.substring(1,u.length-1)),!f){var c=t.context;for(u.startsWith("!")&&(u=a[0].substring(1).trim(),s=!0);u.startsWith("parent().");)u=u.substring(9).trim(),"function"==typeof c.parent&&(c=c.parent());if(0<=u.indexOf("(")&&u.lastIndexOf(")")>=u.indexOf("(")){e=!0;for(var d=u.substring(u.indexOf("(")+1,u.lastIndexOf(")")),u=u.substring(0,u.indexOf("(")),j=/\s?(([^'"]+\(.*\))|([^'",]+)|\'([^']+)\'|\"([^"]+)\")\s?,?\s?/g;null!=(v=j.exec(d));){var l=Ajsf.digObject(t,v[1],i,!0);void 0!==l&&("function"==typeof l[0]?o.push(l[0](...l[1])):o.push(l[0]))}}for(var v,p=/(.*?)\[([0-9]+)\]/g,h=u.split("."),b=0;b<h.length-1;b++)null!==(v=p.exec(h[b]))&&void 0!==c[v[1]][v[2]]?c=c[v[1]][v[2]]:void 0!==c[h[b]]&&(c=c[h[b]]);if(null!==(v=p.exec(h[b]))){if(void 0!==i)return void(c[v[1]][v[2]]=i);n=c[v[1]][v[2]]}else{if(void 0!==i)return void(c[h[b]]=i);n=c[h[b]]}"function"==typeof n&&!r&&e&&(n=n(...o)),s&&(n=!n)}if(r)return[n,o];for(var g=1;g<a.length;g++)null!=a[g]&&(n=Ajsf.filter(t,a[g].trim(),n));return n},filter:function(t,e,i){if(null==i)return i;var r,n,a=(e=e.replace(/\s\s+/g," ")).split(" ")[0];for(n in 0<e.indexOf(" ")&&void 0!==(r=e.substring(e.indexOf(" ")).trim())&&(r=r.startsWith("'")&&r.endsWith("'")||r.startsWith('"')&&r.endsWith('"')?r.substring(1,r.length-1):r.startsWith("{")&&r.endsWith("}")?Ajsf.convertToObject(r):isNaN(r)?Ajsf.digObject(t,r):Number(r)),t.filters)if(n.toLowerCase()===a.toLowerCase()){var s=void 0!==t.context.parent?t.context.parent():t.context;return t.filters[n].definition(s,i,r)}switch(a.toLowerCase()){case"gt":return r<i;case"gte":return r<=i;case"lt":return i<r;case"lte":return i<=r;case"eq":return i==r;case"ne":return i!=r;case"limit":return i.slice(0,Number(r));case"and":return i&&r;case"or":return i||r;case"prefix":return r+i;case"suffix":return i+r;case"filter":if("object"==typeof i&&0<(""+i.constructor).toString().indexOf("Array")){var f,o=[];for(f in i){var c=i[f];if("string"==typeof c)c===r&&o.push(c);else if("object"==typeof c)for(var d in r)c[d]===r[d]&&o.push(c)}return o}return i;default:return console.warn("Filter "+a+" is not implemented yet."),i}},randomString:function(e){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="";for(let t=0;t<e;t++)r+=i.charAt(Math.floor(Math.random()*i.length));return r},refresh:function(d,t,r,e){var i=":not([ajsf-repeated]) > ";t.is("[ajsf-repeated]")&&(i="",void 0!==e&&(i='[ajsf-repeated="'+e+'"]',t=t.parent()));var n,a,u="";for(n in void 0!==r&&void 0!==Ajsf.digObject(d,r)&&(u='="'+r+'"'),t.find(i+"[ajsf-bind"+u+"]").each(function(t,e){var i=r;""===u&&(i=$(e).attr("ajsf-bind")),Ajsf.setVal(e,Ajsf.digObject(d,i))}),t.find(i+"[ajsf-hide"+u+"]").each(function(t,e){var i=$(e),e=r;""===u&&(e=i.attr("ajsf-hide")),Ajsf.digObject(d,e)?i.hide():i.show()}),t.find(i+"[ajsf-show"+u+"]").each(function(t,e){var i=$(e),e=r;""===u&&(e=i.attr("ajsf-show")),Ajsf.digObject(d,e)?i.show():i.hide()}),t.find(i+"[ajsf-class]").each(function(t,e){var i,r=$(e),n=Ajsf.convertToObject(r.attr("ajsf-class"));for(i in n)Ajsf.digObject(d,n[i])?r.hasClass(i)||r.addClass(i):r.removeClass(i)}),void 0===e&&t.find(i+"[ajsf-repeated"+u+"]").each(function(t,e){$(e).remove()}),t.find(i+"[ajsf-title"+u+"]").each(function(t,e){var i=$(e),e=r;""===u&&(e=i.attr("ajsf-title")),i.attr("title",Ajsf.digObject(d,e))}),t.find(i+"[ajsf-text"+u+"]").each(function(t,e){var i=$(e),e=r;""===u&&(e=i.attr("ajsf-text")),i.text(Ajsf.digObject(d,e))}),t.find(i+"[ajsf-repeat"+u+"]").each(function(t,e){var i=$(e),r=void 0;i.hide(),""===u&&(r=i.attr("ajsf-repeat"));var n=Ajsf.digObject(d,r),a="OPTION"===i.prop("tagName");if(void 0!==n){for(var s in n){var f=Ajsf.randomString(6),o=i.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated",a?f:"true").show().insertBefore(i),c={context:{parent:function(){return d.context},item:n[s]},directives:d.directives,filters:d.filters,attributes:d.attributes};"object"==typeof c.context.item&&(c.context.item.index=s),Ajsf.init(c,o,a?f:void 0)}!a||(e=i.parent()).attr("ajsf-bind")&&(r=e.attr("ajsf-bind"),Ajsf.setVal(e[0],Ajsf.digObject(d,r)))}}),d.attributes)t.find(i+"["+n+u+"]").each(function(t,e){var i=r;""===u&&(i=$(e).attr(n)),d.attributes[n].definition(e,Ajsf.digObject(d,i),d.context)});for(n in d.directives){void 0===d.context.directiveInstances&&(d.context.directiveInstances=[]);function s(t){var e=$(t),i=e.attr("ajsf-model"),r=void 0;null!==i&&(r=Ajsf.digObject(d,i)),e.html(f.template);var n={context:{model:r,parent:function(){return d.context},refresh:function(t){t||"function"!=typeof n.context.onRefresh||n.context.onRefresh(),Ajsf.refresh(n,e)}},directives:d.directives,filters:d.filters,attributes:d.attributes};void 0!==f.definition&&(n.context=Object.assign(n.context,f.definition(n.context,t))),Ajsf.init(n,e),d.context.directiveInstances.push(n)}var f=d.directives[n];t.prop("tagName")!==n.toUpperCase()||null===t.attr("ajsf-repeat")&&null===t.attr("ajsf-repeated")?t.find(n).each(function(t,e){var i=$(e);""===i.html()&&null===i.attr("ajsf-repeat")&&null===i.attr("ajsf-repeated")&&s(e)}):""===t.html()&&s(t[0])}for(a in d.context.directiveInstances)void 0!==d.context.directiveInstances[a]&&void 0!==d.context.directiveInstances[a].context&&d.context.directiveInstances[a].context.refresh()},getVal:function(t){var e=$(t);switch(e.prop("type")){case"checkbox":return e.prop("checked");case"radio":for(var i=e.attr("ajsf-bind"),r=$("input[ajsf-bind="+i+"][type=radio]"),n=0;n<=r.length;n++)if((e=$(r[n])).prop("checked"))return e.val();return null;default:return e.val()}},setVal:function(t,e){var i=$(t);if("INPUT"===i.prop("tagName"))switch(i.prop("type")){case"checkbox":i.prop("checked",e);break;case"radio":i.prop("checked",t.value==e);break;default:i.val(e)}else"TEXTAREA"===i.prop("tagName")||"SELECT"===i.prop("tagName")?i.val(e):("OPTION"===i.prop("tagName")&&i.attr("value",e),i.text(e))}},window.ajsf=function(t,e){var i=$('[ajsf="'+t+'"]'),r={context:{},directives:{},directive:function(t,e,i){this.directives[t]={name:t,template:e,definition:i}},filters:{},filter:function(t,e){this.filters[t]={name:t,definition:e}},attributes:{},attribute:function(t,e){this.attributes[t]={name:t,definition:e}}};return r.context.refresh=function(){Ajsf.refresh(r,i)},r.context=Object.assign(r.context,e(r.context)),$(document).ready(function(){Ajsf.init(r,i)}),r};
