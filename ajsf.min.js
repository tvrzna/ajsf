/**
	ajsf 0.0.1

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(e,t){t.find("[ajsf-bind]").each(function(a,i){var r=$(i),n=r.attr("ajsf-bind");if(void 0===Ajsf.digObject(e,n)&&Ajsf.digObject(e,n,""),"INPUT"===r.prop("tagName")||"TEXTAREA"===r.prop("tagName")){var s;if("TEXTAREA"===r.prop("tagName"))s="input";else switch(r.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":s="input";break;case"submit":break;default:s="change"}void 0!==s&&r.on(s,function(){Ajsf.digObject(e,n,Ajsf.getVal(i)),Ajsf.refresh(e,t,n)})}}),t.find("[ajsf-click]").each(function(t,a){var i=$(a),r=i.attr("ajsf-click");i.on("click",function(t){Ajsf.digObject(e,r)(t,a)})}),t.find("[ajsf-keyup]").each(function(t,a){var i=$(a),r=i.attr("ajsf-keyup");i.on("keyup",function(t){Ajsf.digObject(e,r)(t,a)})}),t.find("[ajsf-change]").each(function(t,a){var i=$(a),r=i.attr("ajsf-change");i.on("change",function(t){Ajsf.digObject(e,r)(t,a)})}),Ajsf.refresh(e,t)},digObject:function(e,t,a){var i=t.split("|"),r=i[0].trim(),n=!1;r.startsWith("!")&&(r=i[0].substring(1).trim(),n=!0);for(var s,f=/(.*?)\[([0-9]+)\]/g,c=r.split("."),o=0,p=e.context;o<c.length-1;o++){var d;null!==(d=f.exec(c[o]))&&void 0!==p[d[1]][d[2]]?p=p[d[1]][d[2]]:void 0!==p[c[o]]&&(p=p[c[o]])}if(null!==(d=f.exec(c[o]))){if(void 0!==a)return void(p[d[1]][d[2]]=a);s=p[d[1]][d[2]]}else{if(void 0!==a)return void(p[c[o]]=a);s=p[c[o]]}n&&(s=!s);for(var u=1;u<i.length;u++)null!=i[u]&&(s=Ajsf.filter(e,i[u].trim(),s));return s},filter:function(e,t,a){if(null==a)return a;var i,r;switch(i=(t=t.replace(/\s\s+/g," ")).split(" ")[0],t.indexOf(" ")>0&&void 0!==(r=t.substring(t.indexOf(" ")).trim())&&(r=r.startsWith("'")&&r.endsWith("'")||r.startsWith('"')&&r.endsWith('"')?r.substring(1,r.length-1):isNaN(r)?Ajsf.digObject(e,r):Number(r)),i.toLowerCase()){case"gt":return a>r;case"gte":return a>=r;case"lt":return a<r;case"lte":return a<=r;case"eq":return a==r;case"ne":return a!=r;case"limit":return a.slice(0,Number(r));default:return console.warn("Filter "+i+" is not implemented yet."),a}},refresh:function(app,el,attr){var prefix=":not([ajsf-repeated]) > ";el.is("[ajsf-repeated]")&&(prefix="");var suffix="";for(var name in void 0!==attr&&void 0!==Ajsf.digObject(app,attr)&&(suffix='="'+attr+'"'),el.find(prefix+"[ajsf-bind"+suffix+"]").each(function(e,t){""===suffix&&(attr=$(t).attr("ajsf-bind")),Ajsf.setVal(t,Ajsf.digObject(app,attr))}),el.find(prefix+"[ajsf-hide"+suffix+"]").each(function(e,t){var a=$(t);""===suffix&&(attr=a.attr("ajsf-hide")),Ajsf.digObject(app,attr)?a.hide():a.show()}),el.find(prefix+"[ajsf-show"+suffix+"]").each(function(e,t){var a=$(t);""===suffix&&(attr=a.attr("ajsf-show")),Ajsf.digObject(app,attr)?a.show():a.hide()}),el.find(prefix+"[ajsf-class]").each(function(i,e){var $e=$(e);for(var key in attr=JSON.parse(JSON.stringify(eval("("+$e.attr("ajsf-class")+")"))),attr){var value=Ajsf.digObject(app,key);value?$e.hasClass(attr[key])||$e.addClass(attr[key]):$e.removeClass(attr[key])}}),el.find(prefix+"[ajsf-repeated"+suffix+"]").each(function(e,t){$(t).remove()}),el.find(prefix+"[ajsf-repeat"+suffix+"]").each(function(e,t){var a=$(t);a.hide(),""===suffix&&(attr=a.attr("ajsf-repeat"));var i=Ajsf.digObject(app,attr);if(void 0!==i)for(var r in i){var n=a.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated","true").show().insertBefore(a),s={context:{parent:function(){return app.context},item:i[r]},directives:app.directives};s.context.item.index=r,Ajsf.init(s,n)}}),app.directives){void 0===app.context.directiveInstances&&(app.context.directiveInstances=[]);var directive=app.directives[name],applyDirective=function(e){var t=$(e),a=t.attr("ajsf-model"),i=void 0;if(null!==a)i=Ajsf.digObject(app,a);t.html(directive.template);var r={context:{model:i,parent:function(){return app.context},refresh:function(e){e||"function"!=typeof r.context.onRefresh||r.context.onRefresh(),Ajsf.refresh(r,t)}},directives:app.directives};void 0!==directive.definition&&(r.context=Object.assign(r.context,directive.definition(r.context,e))),Ajsf.init(r,t),app.context.directiveInstances.push(r)};el.prop("tagName")===name.toUpperCase()||null!==el.attr("ajsf-repeat")||null!==el.attr("ajsf-repeated")?""===el.html()&&applyDirective(el[0]):el.find(name).each(function(e,t){var a=$(t);""===a.html()&&null===a.attr("ajsf-repeat")&&null===a.attr("ajsf-repeated")&&applyDirective(t)})}for(var i in app.context.directiveInstances)void 0!==app.context.directiveInstances[i]&&void 0!==app.context.directiveInstances[i].context&&app.context.directiveInstances[i].context.refresh()},getVal:function(e){var t=$(e);switch(t.prop("type")){case"checkbox":return t.prop("checked");case"radio":for(var a=t.attr("ajsf-bind"),i=$("input[ajsf-bind="+a+"][type=radio]"),r=0;r<=i.length;r++)if((t=$(i[r])).prop("checked"))return t.val();return null;default:return t.val()}},setVal:function(e,t){var a=$(e);if("INPUT"===a.prop("tagName"))switch(a.prop("type")){case"checkbox":a.prop("checked",t);break;case"radio":a.prop("checked",e.value==t);break;default:a.val(t)}else"SPAN"===a.prop("tagName")||"DIV"===a.prop("tagName")||"P"===a.prop("tagName")||"BUTTON"===a.prop("tagName")?a.text(t):console.warn("Report element "+a.prop("tagName")+" was missed, please.")}},window.ajsf=function(e,t){var a=$('[ajsf="'+e+'"]'),i={context:{},directives:{},directive:function(e,t,a){this.directives[e]={template:t,definition:a}}};return i.context.refresh=function(){Ajsf.refresh(i,a)},i.context=Object.assign(i.context,t(i.context)),$(document).ready(function(){Ajsf.init(i,a)}),i};
