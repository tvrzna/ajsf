/**
	ajsf 0.0.1-20211105

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(n,s,e){for(var t in s.find("[ajsf-bind]").each(function(e,t){var i,a=$(t),r=a.attr("ajsf-bind");if(void 0===Ajsf.digObject(n,r)&&Ajsf.digObject(n,r,""),"INPUT"===a.prop("tagName")||"TEXTAREA"===a.prop("tagName")||"SELECT"===a.prop("tagName")){if("TEXTAREA"===a.prop("tagName"))i="input";else switch(a.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":i="input";break;case"submit":break;default:i="change"}void 0!==i&&a.on(i,function(){Ajsf.digObject(n,r,Ajsf.getVal(t)),Ajsf.refresh(n,s,r)})}}),createEvent=function(a){s.find("["+a+"]").each(function(e,t){var t=$(t),i=t.attr(a);t.on(Ajsf.basicEvents[a],function(e){var t=Ajsf.digObject(n,i,void 0,!0);"function"==typeof t[0]&&t[0](e,...t[1],$(this))})})},Ajsf.basicEvents)createEvent(t);Ajsf.refresh(n,s,void 0,e)},basicEvents:{"ajsf-blur":"blur","ajsf-change":"change","ajsf-click":"click","ajsf-keydown":"keydown","ajsf-keyup":"keyup","ajsf-mousedown":"mousedown","ajsf-mouseup":"mouseup","ajsf-submit":"submit"},digObject:function(e,t,i,a){var r,n=t.split("|"),s=!1,f=!1,t=!1,c=[];if(((d=n[0].trim()).startsWith("'")&&d.endsWith("'")||d.startsWith('"')&&d.endsWith('"'))&&(f=!0,r=d.substring(1,d.length-1)),!f){var o=e.context;for(d.startsWith("!")&&(d=n[0].substring(1).trim(),s=!0);d.startsWith("parent().");)d=d.substring(9).trim(),"function"==typeof o.parent&&(o=o.parent());if(0<=d.indexOf("(")&&d.lastIndexOf(")")>=d.indexOf("(")){t=!0;for(var p=d.substring(d.indexOf("(")+1,d.lastIndexOf(")")),d=d.substring(0,d.indexOf("(")),u=/\s?(([^'"]+\(.*\))|([^'",]+)|\'([^']+)\'|\"([^"]+)\")\s?,?\s?/g;null!=(v=u.exec(p));){var l=Ajsf.digObject(e,v[1],i,!0);void 0!==l&&("function"==typeof l[0]?c.push(l[0](...l[1])):c.push(l[0]))}}for(var v,j=/(.*?)\[([0-9]+)\]/g,x=d.split("."),h=0;h<x.length-1;h++)null!==(v=j.exec(x[h]))&&void 0!==o[v[1]][v[2]]?o=o[v[1]][v[2]]:void 0!==o[x[h]]&&(o=o[x[h]]);if(null!==(v=j.exec(x[h]))){if(void 0!==i)return void(o[v[1]][v[2]]=i);r=o[v[1]][v[2]]}else{if(void 0!==i)return void(o[x[h]]=i);r=o[x[h]]}"function"==typeof r&&!a&&t&&(r=r(...c)),s&&(r=!r)}if(a)return[r,c];for(var b=1;b<n.length;b++)null!=n[b]&&(r=Ajsf.filter(e,n[b].trim(),r));return r},filter:function(e,t,i){if(null==i)return i;var a,r,n=(t=t.replace(/\s\s+/g," ")).split(" ")[0];for(r in 0<t.indexOf(" ")&&void 0!==(a=t.substring(t.indexOf(" ")).trim())&&(a=a.startsWith("'")&&a.endsWith("'")||a.startsWith('"')&&a.endsWith('"')?a.substring(1,a.length-1):isNaN(a)?Ajsf.digObject(e,a):Number(a)),e.filters)if(r.toLowerCase()===n.toLowerCase()){var s=void 0!==e.context.parent?e.context.parent():e.context;return e.filters[r].definition(s,i,a)}switch(n.toLowerCase()){case"gt":return a<i;case"gte":return a<=i;case"lt":return i<a;case"lte":return i<=a;case"eq":return i==a;case"ne":return i!=a;case"limit":return i.slice(0,Number(a));case"and":return i&&a;case"or":return i||a;case"prefix":return a+i;case"suffix":return i+a;case"filter":if("object"==typeof i&&0<(""+i.constructor).toString().indexOf("Array")){var f,c=[];for(f in i){var o=i[f];if("string"==typeof o)o===a&&c.push(o);else if("object"==typeof o)for(var p in a)o[p]===a[p]&&c.push(o)}return c}return i;default:return console.warn("Filter "+n+" is not implemented yet."),i}},randomString:function(t){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="";for(let e=0;e<t;e++)a+=i.charAt(Math.floor(Math.random()*i.length));return a},refresh:function(app,el,attr,id){var prefix=":not([ajsf-repeated]) > ";el.is("[ajsf-repeated]")&&(prefix="",void 0!==id&&(prefix='[ajsf-repeated="'+id+'"]',el=el.parent()));var suffix="",name,name,i;for(name in void 0!==attr&&void 0!==Ajsf.digObject(app,attr)&&(suffix='="'+attr+'"'),el.find(prefix+"[ajsf-bind"+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr("ajsf-bind")),Ajsf.setVal(t,Ajsf.digObject(app,i))}),el.find(prefix+"[ajsf-hide"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-hide")),Ajsf.digObject(app,t)?i.hide():i.show()}),el.find(prefix+"[ajsf-show"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-show")),Ajsf.digObject(app,t)?i.show():i.hide()}),el.find(prefix+"[ajsf-class]").each(function(i,e){var $e=$(e),cpyAttr=JSON.parse(JSON.stringify(eval("("+$e.attr("ajsf-class")+")"))),styleClass;for(styleClass in cpyAttr){var value=Ajsf.digObject(app,cpyAttr[styleClass]);value?$e.hasClass(styleClass)||$e.addClass(styleClass):$e.removeClass(styleClass)}}),void 0===id&&el.find(prefix+"[ajsf-repeated"+suffix+"]").each(function(e,t){$(t).remove()}),el.find(prefix+"[ajsf-title"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-title")),i.attr("title",Ajsf.digObject(app,t))}),el.find(prefix+"[ajsf-text"+suffix+"]").each(function(e,t){var i=$(t),t=attr;""===suffix&&(t=i.attr("ajsf-text")),i.text(Ajsf.digObject(app,t))}),el.find(prefix+"[ajsf-repeat"+suffix+"]").each(function(e,t){var i=$(t),a=void 0;i.hide(),""===suffix&&(a=i.attr("ajsf-repeat"));var r=Ajsf.digObject(app,a),n="OPTION"===i.prop("tagName");if(void 0!==r){for(var s in r){var f=Ajsf.randomString(6),c=i.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated",n?f:"true").show().insertBefore(i),o={context:{parent:function(){return app.context},item:r[s]},directives:app.directives,filters:app.filters,attributes:app.attributes};"object"==typeof o.context.item&&(o.context.item.index=s),Ajsf.init(o,c,n?f:void 0)}!n||(t=i.parent()).attr("ajsf-bind")&&(a=t.attr("ajsf-bind"),Ajsf.setVal(t[0],Ajsf.digObject(app,a)))}}),app.attributes)el.find(prefix+"["+name+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr(name)),app.attributes[name].definition(t,Ajsf.digObject(app,i),app.context)});for(name in app.directives){void 0===app.context.directiveInstances&&(app.context.directiveInstances=[]);var directive=app.directives[name],applyDirective=function(e){var t=$(e),i=t.attr("ajsf-model"),a=void 0;null!==i&&(a=Ajsf.digObject(app,i)),t.html(directive.template);var r={context:{model:a,parent:function(){return app.context},refresh:function(e){e||"function"!=typeof r.context.onRefresh||r.context.onRefresh(),Ajsf.refresh(r,t)}},directives:app.directives,filters:app.filters,attributes:app.attributes};void 0!==directive.definition&&(r.context=Object.assign(r.context,directive.definition(r.context,e))),Ajsf.init(r,t),app.context.directiveInstances.push(r)};el.prop("tagName")!==name.toUpperCase()||null===el.attr("ajsf-repeat")&&null===el.attr("ajsf-repeated")?el.find(name).each(function(e,t){var i=$(t);""===i.html()&&null===i.attr("ajsf-repeat")&&null===i.attr("ajsf-repeated")&&applyDirective(t)}):""===el.html()&&applyDirective(el[0])}for(i in app.context.directiveInstances)void 0!==app.context.directiveInstances[i]&&void 0!==app.context.directiveInstances[i].context&&app.context.directiveInstances[i].context.refresh()},getVal:function(e){var t=$(e);switch(t.prop("type")){case"checkbox":return t.prop("checked");case"radio":for(var i=t.attr("ajsf-bind"),a=$("input[ajsf-bind="+i+"][type=radio]"),r=0;r<=a.length;r++)if((t=$(a[r])).prop("checked"))return t.val();return null;default:return t.val()}},setVal:function(e,t){var i=$(e);if("INPUT"===i.prop("tagName"))switch(i.prop("type")){case"checkbox":i.prop("checked",t);break;case"radio":i.prop("checked",e.value==t);break;default:i.val(t)}else"TEXTAREA"===i.prop("tagName")||"SELECT"===i.prop("tagName")?i.val(t):("OPTION"===i.prop("tagName")&&i.attr("value",t),i.text(t))}},window.ajsf=function(e,t){var i=$('[ajsf="'+e+'"]'),a={context:{},directives:{},directive:function(e,t,i){this.directives[e]={name:e,template:t,definition:i}},filters:{},filter:function(e,t){this.filters[e]={name:e,definition:t}},attributes:{},attribute:function(e,t){this.attributes[e]={name:e,definition:t}}};return a.context.refresh=function(){Ajsf.refresh(a,i)},a.context=Object.assign(a.context,t(a.context)),$(document).ready(function(){Ajsf.init(a,i)}),a};
