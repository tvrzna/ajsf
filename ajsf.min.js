/**
	ajsf 0.0.1-20211119

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(s,a,t){for(var e in a.find("[ajsf-bind]").each(function(t,e){var n,i=$(e),r=i.attr("ajsf-bind");if(void 0===Ajsf.digObject(s,r)&&Ajsf.digObject(s,r,""),"INPUT"===i.prop("tagName")||"TEXTAREA"===i.prop("tagName")||"SELECT"===i.prop("tagName")){if("TEXTAREA"===i.prop("tagName"))n="input";else switch(i.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":n="input";break;case"submit":break;default:n="change"}void 0!==n&&i.on(n,function(){Ajsf.digObject(s,r,Ajsf.getVal(e)),Ajsf.refresh(s,a,r)})}}),createEvent=function(i){a.find("["+i+"]").each(function(t,e){var e=$(e),n=e.attr(i);e.on(Ajsf.basicEvents[i],function(t){var e=Ajsf.digObject(s,n,void 0,!0);"function"==typeof e[0]&&e[0](t,...e[1],$(this))})})},Ajsf.basicEvents)createEvent(e);Ajsf.refresh(s,a,void 0,t)},basicEvents:{"ajsf-blur":"blur","ajsf-change":"change","ajsf-click":"click","ajsf-keydown":"keydown","ajsf-keyup":"keyup","ajsf-mousedown":"mousedown","ajsf-mouseup":"mouseup","ajsf-submit":"submit"},convertToObject:function(str){return JSON.parse(JSON.stringify(eval("("+str+")")))},digObject:function(t,e,n,i){var r,s=e.match(/(([^\|]+)|([^\'\|]*\'[^\']*\'[^\'\|]+))/g),a=!1,o=[];if((d=s[0].trim()).startsWith("'")&&d.endsWith("'")||d.startsWith('"')&&d.endsWith('"'))r=d.substring(1,d.length-1);else if(d.startsWith("!")&&(d=d.substring(1).trim(),a=!0),"false"===d||"true"===d)r="true"===d;else if("undefined"===d)r=void 0;else if(isNaN(d)){var f=t.context;if(d.startsWith("root()."))for(d=d.substring(7).trim();"function"==typeof f.parent;)f=f.parent();for(;d.startsWith("parent().");)d=d.substring(9).trim(),"function"==typeof f.parent&&(f=f.parent());if(0<=d.indexOf("(")&&d.lastIndexOf(")")>=d.indexOf("("))for(var c=d.substring(d.indexOf("(")+1,d.lastIndexOf(")")),d=d.substring(0,d.indexOf("(")),u=/\s?(([^'"]+\(.*\))|([^'",]+)|\'([^']*)\'|\"([^"]*)\")\s?,?\s?/g;null!==(v=u.exec(c));){var v=Ajsf.digObject(t,v[1],n,!0);o.push("function"==typeof v[0]?v[0](...v[1]):v[0])}for(var l=/\[([^\]]*\]*)\]/g,j=d.split("."),p=0;p<j.length-1;p++){var h=j[p].substring(0,j[p].indexOf("["));l.lastIndex=0;var b=l.exec(j[p]);null!==b&&void 0!==b[1]?(b=Ajsf.digObject(t,b[1]),f=f[h][b]):void 0!==f[j[p]]&&(f=f[j[p]])}l.lastIndex=0;var g=l.exec(j[p]);if(null!==g&&void 0!==g[1]){e=j[p].substring(0,j[p].indexOf("[")),g=Ajsf.digObject(t,g[1]);if(void 0!==n)return void(f[e][g]=n);r=f[e][g]}else{if(void 0!==n)return void(f[j[p]]=n);r=f[j[p]]}}else r=Number(d);if("function"!=typeof r||i||(r=r(...o)),a&&(r=!r),i)return[r,o];for(var x=1;x<s.length;x++)void 0!==s[x]&&(r=Ajsf.filter(t,s[x].trim(),r));return r},filter:function(t,e,n){if(null==n)return n;var i,r,s=(e=e.replace(/\s\s+/g," ")).split(" ")[0];for(r in 0<e.indexOf(" ")&&void 0!==(i=e.substring(e.indexOf(" ")).trim())&&(i=i.startsWith("'")&&i.endsWith("'")||i.startsWith('"')&&i.endsWith('"')?i.substring(1,i.length-1):i.startsWith("{")&&i.endsWith("}")?Ajsf.convertToObject(i):isNaN(i)?Ajsf.digObject(t,i):Number(i)),t.filters)if(r.toLowerCase()===s.toLowerCase()){var a=void 0!==t.context.parent?t.context.parent():t.context;return t.filters[r].definition(a,n,i)}switch(s.toLowerCase()){case"gt":return i<n;case"gte":return i<=n;case"lt":return n<i;case"lte":return n<=i;case"eq":return n==i;case"ne":return n!=i;case"limit":return n.slice(0,Number(i));case"and":return n&&i;case"or":return n||i;case"prefix":return i+n;case"suffix":return n+i;case"filter":if("object"==typeof n&&0<(""+n.constructor).toString().indexOf("Array")){var o,f=[];for(o in n){var c=n[o];if("string"==typeof c)c===i&&f.push(c);else if("object"==typeof c)for(var d in i)c[d]===i[d]&&f.push(c)}return f}return n;default:return console.warn("Filter "+s+" is not implemented yet."),n}},randomString:function(e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="";for(let t=0;t<e;t++)i+=n.charAt(Math.floor(Math.random()*n.length));return i},refresh:function(d,t,i,e){var n=":not([ajsf-repeated]) > ";t.is("[ajsf-repeated]")&&(n="",void 0!==e&&(n='[ajsf-repeated="'+e+'"]',t=t.parent()));var r,u="";for(r in void 0!==i&&void 0!==Ajsf.digObject(d,i)&&(u='="'+i+'"'),t.find(n+"[ajsf-bind"+u+"]").each(function(t,e){var n=i;""===u&&(n=$(e).attr("ajsf-bind")),Ajsf.setVal(e,Ajsf.digObject(d,n))}),t.find(n+"[ajsf-hide"+u+"]").each(function(t,e){var n=$(e),e=i;""===u&&(e=n.attr("ajsf-hide")),Ajsf.digObject(d,e)?n.hide():n.show()}),t.find(n+"[ajsf-show"+u+"]").each(function(t,e){var n=$(e),e=i;""===u&&(e=n.attr("ajsf-show")),Ajsf.digObject(d,e)?n.show():n.hide()}),t.find(n+"[ajsf-class]").each(function(t,e){var n,i=$(e),r=Ajsf.convertToObject(i.attr("ajsf-class"));for(n in r)Ajsf.digObject(d,r[n])?i.hasClass(n)||i.addClass(n):i.removeClass(n)}),void 0===e&&t.find(n+"[ajsf-repeated"+u+"]").each(function(t,e){$(e).remove()}),t.find(n+"[ajsf-title"+u+"]").each(function(t,e){var n=$(e),e=i;""===u&&(e=n.attr("ajsf-title")),n.attr("title",Ajsf.digObject(d,e))}),t.find(n+"[ajsf-text"+u+"]").each(function(t,e){var n=$(e),e=i;""===u&&(e=n.attr("ajsf-text")),n.text(Ajsf.digObject(d,e))}),t.find(n+"[ajsf-repeat"+u+"]").each(function(t,e){var n=$(e),i=void 0;n.hide(),""===u&&(i=n.attr("ajsf-repeat"));var r=Ajsf.digObject(d,i),s="OPTION"===n.prop("tagName");if(void 0!==r){for(var a in r){var o=Ajsf.randomString(6),f=n.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated",s?o:"true").show().insertBefore(n),c={context:{parent:function(){return d.context},root:function(){for(var t=c.context;"function"==typeof t.parent;)t=t.parent();return t},item:r[a]},directives:d.directives,filters:d.filters,attributes:d.attributes};"object"==typeof c.context.item&&(c.context.item.index=a),Ajsf.init(c,f,s?o:void 0)}!s||(e=n.parent()).attr("ajsf-bind")&&(i=e.attr("ajsf-bind"),Ajsf.setVal(e[0],Ajsf.digObject(d,i)))}}),d.attributes)t.find(n+"["+r+u+"]").each(function(t,e){var n=i;""===u&&(n=$(e).attr(r)),d.attributes[r].definition(e,Ajsf.digObject(d,n),d.context)});for(r in d.directives){void 0===d.context.directiveInstances&&(d.context.directiveInstances=[]);function s(t){var e=$(t),n=e.attr("ajsf-model"),i=void 0;null!==n&&(i=Ajsf.digObject(d,n)),e.html(a.template);var r={context:{model:i,parent:function(){return d.context},root:function(){for(var t=r.context;"function"==typeof t.parent;)t=t.parent();return t},refresh:function(t){t||"function"!=typeof r.context.onRefresh||r.context.onRefresh(),Ajsf.refresh(r,e)}},directives:d.directives,filters:d.filters,attributes:d.attributes,element:t};d.context.directiveInstances.push(r),void 0!==a.definition&&(r.context=Object.assign(r.context,a.definition(r.context,t))),Ajsf.init(r,e)}var a=d.directives[r];t.prop("tagName")!==r.toUpperCase()||null===t.attr("ajsf-repeat")&&null===t.attr("ajsf-repeated")?t.find(r).each(function(t,e){var n=$(e);""===n.html()&&null===n.attr("ajsf-repeat")&&null===n.attr("ajsf-repeated")&&s(e)}):""===t.html()&&s(t[0])}if(void 0!==d.context.directiveInstances&&0<d.context.directiveInstances.length){for(var o=d.context.directiveInstances.length-1;0<=o;o--)void 0!==d.context.directiveInstances[o]&&(void 0===d.context.directiveInstances[o].element||document.body.contains(d.context.directiveInstances[o].element))||d.context.directiveInstances.splice(o,1);for(o in d.context.directiveInstances)void 0!==d.context.directiveInstances[o]&&void 0!==d.context.directiveInstances[o].context&&d.context.directiveInstances[o].context.refresh()}},getVal:function(t){var e=$(t);switch(e.prop("type")){case"checkbox":return e.prop("checked");case"radio":for(var n=e.attr("ajsf-bind"),i=$("input[ajsf-bind="+n+"][type=radio]"),r=0;r<=i.length;r++)if((e=$(i[r])).prop("checked"))return e.val();return null;default:return e.val()}},setVal:function(t,e){var n=$(t);if("INPUT"===n.prop("tagName"))switch(n.prop("type")){case"checkbox":n.prop("checked",e);break;case"radio":n.prop("checked",t.value==e);break;default:n.val(e)}else"TEXTAREA"===n.prop("tagName")||"SELECT"===n.prop("tagName")?n.val(e):("OPTION"===n.prop("tagName")&&n.attr("value",e),n.text(e))}},window.ajsf=function(t,e){var n=$('[ajsf="'+t+'"]'),i={context:{},directives:{},directive:function(t,e,n){this.directives[t]={name:t,template:e,definition:n}},filters:{},filter:function(t,e){this.filters[t]={name:t,definition:e}},attributes:{},attribute:function(t,e){this.attributes[t]={name:t,definition:e}}};return i.context.refresh=function(){Ajsf.refresh(i,n)},i.context=Object.assign(i.context,e(i.context)),$(document).ready(function(){Ajsf.init(i,n)}),i};
