/**
	ajsf 0.0.1

	https://github.com/tvrzna/ajsf
**/
Ajsf={init:function(e,t){t.find("[ajsf-bind]").each(function(i,a){var r=$(a),n=r.attr("ajsf-bind");if(void 0===Ajsf.digObject(e,n)&&Ajsf.digObject(e,n,""),"INPUT"===r.prop("tagName")||"TEXTAREA"===r.prop("tagName")){var s;if("TEXTAREA"===r.prop("tagName"))s="input";else switch(r.prop("type")){case"text":case"password":case"email":case"url":case"search":case"number":s="input";break;case"submit":break;default:s="change"}void 0!==s&&r.on(s,function(){Ajsf.digObject(e,n,Ajsf.getVal(a)),Ajsf.refresh(e,t,n)})}}),t.find("[ajsf-click]").each(function(t,i){var a=$(i),r=a.attr("ajsf-click");a.on("click",function(t){Ajsf.digObject(e,r)(t,i)})}),t.find("[ajsf-keyup]").each(function(t,i){var a=$(i),r=a.attr("ajsf-keyup");a.on("keyup",function(t){Ajsf.digObject(e,r)(t,i)})}),t.find("[ajsf-change]").each(function(t,i){var a=$(i),r=a.attr("ajsf-change");a.on("change",function(t){Ajsf.digObject(e,r)(t,i)})}),Ajsf.refresh(e,t)},digObject:function(e,t,i){var a,r=t.split("|"),n=r[0].trim(),s=!1,f=!1;if((n.startsWith("'")&&n.endsWith("'")||n.startsWith('"')&&n.endsWith('"'))&&(f=!0,a=n.substring(1,n.length-1)),!f){n.startsWith("!")&&(n=r[0].substring(1).trim(),s=!0);for(var c=/(.*?)\[([0-9]+)\]/g,o=n.split("."),p=0,d=e.context;p<o.length-1;p++){null!==(l=c.exec(o[p]))&&void 0!==d[l[1]][l[2]]?d=d[l[1]][l[2]]:void 0!==d[o[p]]&&(d=d[o[p]])}var l;if(null!==(l=c.exec(o[p]))){if(void 0!==i)return void(d[l[1]][l[2]]=i);a=d[l[1]][l[2]]}else{if(void 0!==i)return void(d[o[p]]=i);a=d[o[p]]}s&&(a=!a)}for(var u=1;u<r.length;u++)null!=r[u]&&(a=Ajsf.filter(e,r[u].trim(),a));return a},filter:function(e,t,i){if(null==i)return i;var a,r;for(var n in a=(t=t.replace(/\s\s+/g," ")).split(" ")[0],t.indexOf(" ")>0&&void 0!==(r=t.substring(t.indexOf(" ")).trim())&&(r=r.startsWith("'")&&r.endsWith("'")||r.startsWith('"')&&r.endsWith('"')?r.substring(1,r.length-1):isNaN(r)?Ajsf.digObject(e,r):Number(r)),e.filters)if(n.toLowerCase()===a.toLowerCase()){var s=void 0!==e.context.parent?e.context.parent():e.context;return e.filters[n].definition(s,i,r)}switch(a.toLowerCase()){case"gt":return i>r;case"gte":return i>=r;case"lt":return i<r;case"lte":return i<=r;case"eq":return i==r;case"ne":return i!=r;case"limit":return i.slice(0,Number(r));default:return console.warn("Filter "+a+" is not implemented yet."),i}},refresh:function(app,el,attr){var prefix=":not([ajsf-repeated]) > ";el.is("[ajsf-repeated]")&&(prefix="");var suffix="";for(var name in void 0!==attr&&void 0!==Ajsf.digObject(app,attr)&&(suffix='="'+attr+'"'),el.find(prefix+"[ajsf-bind"+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr("ajsf-bind")),Ajsf.setVal(t,Ajsf.digObject(app,i))}),el.find(prefix+"[ajsf-hide"+suffix+"]").each(function(e,t){var i=$(t),a=attr;""===suffix&&(a=i.attr("ajsf-hide")),Ajsf.digObject(app,a)?i.hide():i.show()}),el.find(prefix+"[ajsf-show"+suffix+"]").each(function(e,t){var i=$(t),a=attr;""===suffix&&(a=i.attr("ajsf-show")),Ajsf.digObject(app,a)?i.show():i.hide()}),el.find(prefix+"[ajsf-class]").each(function(i,e){var $e=$(e),cpyAttr=JSON.parse(JSON.stringify(eval("("+$e.attr("ajsf-class")+")")));for(var styleClass in cpyAttr){var value=Ajsf.digObject(app,cpyAttr[styleClass]);value?$e.hasClass(styleClass)||$e.addClass(styleClass):$e.removeClass(styleClass)}}),el.find(prefix+"[ajsf-repeated"+suffix+"]").each(function(e,t){$(t).remove()}),el.find(prefix+"[ajsf-title"+suffix+"]").each(function(e,t){var i=$(t),a=attr;""===suffix&&(a=i.attr("ajsf-title")),i.attr("title",Ajsf.digObject(app,a))}),el.find(prefix+"[ajsf-repeat"+suffix+"]").each(function(e,t){var i=$(t),a=attr;i.hide(),""===suffix&&(a=i.attr("ajsf-repeat"));var r=Ajsf.digObject(app,a);if(void 0!==r)for(var n in r){var s=i.clone().removeAttr("ajsf-repeat").attr("ajsf-repeated","true").show().insertBefore(i),f={context:{parent:function(){return app.context},item:r[n]},directives:app.directives,filters:app.filters};f.context.item.index=n,Ajsf.init(f,s)}}),app.attributes)el.find(prefix+"["+name+suffix+"]").each(function(e,t){var i=attr;""===suffix&&(i=$(t).attr(name)),app.attributes[name].definition(t,Ajsf.digObject(app,i),app.context)});for(var name in app.directives){void 0===app.context.directiveInstances&&(app.context.directiveInstances=[]);var directive=app.directives[name],applyDirective=function(e){var t=$(e),i=t.attr("ajsf-model"),a=void 0;if(null!==i)a=Ajsf.digObject(app,i);t.html(directive.template);var r={context:{model:a,parent:function(){return app.context},refresh:function(e){e||"function"!=typeof r.context.onRefresh||r.context.onRefresh(),Ajsf.refresh(r,t)}},directives:app.directives,filters:app.filters};void 0!==directive.definition&&(r.context=Object.assign(r.context,directive.definition(r.context,e))),Ajsf.init(r,t),app.context.directiveInstances.push(r)};el.prop("tagName")!==name.toUpperCase()||null===el.attr("ajsf-repeat")&&null===el.attr("ajsf-repeated")?el.find(name).each(function(e,t){var i=$(t);""===i.html()&&null===i.attr("ajsf-repeat")&&null===i.attr("ajsf-repeated")&&applyDirective(t)}):""===el.html()&&applyDirective(el[0])}for(var i in app.context.directiveInstances)void 0!==app.context.directiveInstances[i]&&void 0!==app.context.directiveInstances[i].context&&app.context.directiveInstances[i].context.refresh()},getVal:function(e){var t=$(e);switch(t.prop("type")){case"checkbox":return t.prop("checked");case"radio":for(var i=t.attr("ajsf-bind"),a=$("input[ajsf-bind="+i+"][type=radio]"),r=0;r<=a.length;r++)if((t=$(a[r])).prop("checked"))return t.val();return null;default:return t.val()}},setVal:function(e,t){var i=$(e);if("INPUT"===i.prop("tagName"))switch(i.prop("type")){case"checkbox":i.prop("checked",t);break;case"radio":i.prop("checked",e.value==t);break;default:i.val(t)}else i.text(t)}},window.ajsf=function(e,t){var i=$('[ajsf="'+e+'"]'),a={context:{},directives:{},directive:function(e,t,i){this.directives[e]={name:e,template:t,definition:i}},filters:{},filter:function(e,t){this.filters[e]={name:e,definition:t}},attributes:{},attribute:function(e,t){this.attributes[e]={name:e,definition:t}}};return a.context.refresh=function(){Ajsf.refresh(a,i)},a.context=Object.assign(a.context,t(a.context)),$(document).ready(function(){Ajsf.init(a,i)}),a};
